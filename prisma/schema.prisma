generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model User {
    id               String            @id @default(uuid())
    firebaseUid      String            @unique
    name             String
    email            String            @unique
    role             Role              @default(VOLUNTEER)
    committee        String?
    createdAt        DateTime          @default(now())
    shiftAssignments ShiftAssignment[]
    swapRequests     SwapRequest[]
    swapFulfillments SwapFulfillment[]
    attendance       Attendance[]
}

model TimeBlock {
    id               String            @id @default(uuid())
    name             String // e.g. "Morning", "Afternoon"
    startTime        String // stored as "HH:MM" e.g. "09:00"
    endTime          String // stored as "HH:MM" e.g. "11:00"
    createdAt        DateTime          @default(now())
    shifts           Shift[]
    swapRequests     SwapRequest[]
    swapFulfillments SwapFulfillment[]
}

model Shift {
    id               String            @id @default(uuid())
    date             DateTime
    timeBlockId      String
    committee        String
    capacity         Int
    createdAt        DateTime          @default(now())
    timeBlock        TimeBlock         @relation(fields: [timeBlockId], references: [id])
    shiftAssignments ShiftAssignment[]
    swapRequests     SwapRequest[]
    attendance       Attendance[]
}

model ShiftAssignment {
    id        String   @id @default(uuid())
    userId    String
    shiftId   String
    createdAt DateTime @default(now())
    user      User     @relation(fields: [userId], references: [id])
    shift     Shift    @relation(fields: [shiftId], references: [id])
}

model SwapRequest {
    id               String            @id @default(uuid())
    requesterId      String
    shiftId          String
    timeBlockId      String // which block of the shift is being offered
    status           SwapStatus        @default(OPEN)
    reason           String?
    createdAt        DateTime          @default(now())
    requester        User              @relation(fields: [requesterId], references: [id])
    shift            Shift             @relation(fields: [shiftId], references: [id])
    timeBlock        TimeBlock         @relation(fields: [timeBlockId], references: [id])
    swapFulfillments SwapFulfillment[]
}

model SwapFulfillment {
    id            String      @id @default(uuid())
    swapRequestId String
    volunteerId   String
    timeBlockId   String // which block they're covering
    approvedBy    String?
    approvedAt    DateTime?
    createdAt     DateTime    @default(now())
    swapRequest   SwapRequest @relation(fields: [swapRequestId], references: [id])
    volunteer     User        @relation(fields: [volunteerId], references: [id])
    timeBlock     TimeBlock   @relation(fields: [timeBlockId], references: [id])
}

model Attendance {
    id        String           @id @default(uuid())
    userId    String
    shiftId   String
    status    AttendanceStatus @default(PRESENT)
    notes     String?
    markedBy  String? // admin who marked it
    createdAt DateTime         @default(now())
    user      User             @relation(fields: [userId], references: [id])
    shift     Shift            @relation(fields: [shiftId], references: [id])
}

enum Role {
    VOLUNTEER
    ADMIN
}

enum SwapStatus {
    OPEN
    PARTIALLY_FILLED
    FILLED
    CANCELLED
}

enum AttendanceStatus {
    PRESENT
    ABSENT
    LATE
    EXCUSED
}
